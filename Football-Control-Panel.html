
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Football Scoreboard Controller</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background: #121212; color: white; font-family: 'Segoe UI', sans-serif;
    }
    .container { max-width: 500px; margin: auto; padding: 10px; }
    .row, .logo-row, .label-row, .score-row, .footer-row { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
    .center { justify-content: center; }
    input, select, button { padding: 6px; border-radius: 4px; font-size: 0.9rem; border: none; }
    button { background: #219653; color: white; cursor: pointer; }
    button:hover { background: #1b7f45; }
    .logo-name { flex: 1; display: flex; flex-direction: column; align-items: center; }
    .logo-name img { width: 60px; height: 60px; object-fit: contain; background: #2a2a2a; border-radius: 6px; }
    .logo-name .name { font-size: 0.75rem; text-align: center; height: 2.4em; overflow: hidden; }
    .label-row div {
      flex: 1; background: #1e1e1e; text-align: center; font-size: 0.75rem; border-radius: 4px; padding: 4px;
    }
    .score-box, .button-col {
      display: flex; flex-direction: column; align-items: center; flex: 1;
    }
    .score-box .score { font-size: 2.2em; margin-bottom: 6px; }
    .button-col button.plus { width: 90%; font-size: 1.2rem; height: 40px; }
    .button-col button.minus {
      width: 90%; font-size: 0.9rem; height: 25px; background: #c0392b;
    }
    .section-divider { border-top: 1px solid #555; margin: 12px 0; }
    .popup { display: none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: #1e1e1e; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; }
    .popup textarea { width: 100%; height: 80px; margin-top: 6px; }
    .popup input { width: 100%; margin-bottom: 6px; }
    .small { font-size: 0.75rem; color: #ccc; }
    #copyBtn { flex: 1.5; font-size: 0.85rem; }
    .popup-title { margin: 10px 0 5px; font-weight: bold; border-top: 1px solid #444; padding-top: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <label>Row:</label>
      <input type="number" id="rowIndex" value="1" style="width:60px;">
      <button onclick="applyRow()">Load</button>
      <button id="copyBtn" onclick="copyDetails()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
    </div>

    <div class="section-divider"></div>
    <div class="logo-row">
      <div class="logo-name">
        <img id="logoA" src="" alt="Logo A">
        <div class="name" id="nameA">Team A</div>
      </div>
      <div class="logo-name">
        <img id="logoB" src="" alt="Logo B">
        <div class="name" id="nameB">Team B</div>
      </div>
    </div>
    <div class="label-row">
      <div id="label1">Label 1</div>
      <div id="label2">Label 2</div>
      <div id="label3">Label 3</div>
    </div>

    <div class="section-divider"></div>
    <div><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong></div>
    <div class="score-row">
      <div class="score-box"><div class="score" id="scoreA">0</div></div>
      <div class="button-col">
        <button class="plus" onclick="changeScore('A', 1)">+1</button>
        <button class="minus" onclick="changeScore('A', -1)">-1</button>
      </div>
      <div class="score-box"><div class="score" id="scoreB">0</div></div>
      <div class="button-col">
        <button class="plus" onclick="changeScore('B', 1)">+1</button>
        <button class="minus" onclick="changeScore('B', -1)">-1</button>
      </div>
    </div>
    <div class="center">
      <button onclick="resetScore()">Reset Scores</button>
    </div>

    <div class="section-divider"></div>
    <div><strong>‡πÄ‡∏ß‡∏•‡∏≤</strong></div>
    <div class="footer-row">
      <button onclick="toggleHalf()">‡∏Ñ‡∏£‡∏∂‡πà‡∏á <span id="halfText">1st</span></button>
      <div style="flex:1;text-align:center">
        <div id="timerText" style="font-size:2em;">00:00</div>
        <div style="margin-top:5px;">
          <button onclick="startTimer()">Start</button>
          <button onclick="stopTimer()">Stop</button>
          <button onclick="resetTimer()">Reset</button>
          <button onclick="setTime()">Set</button>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>
    <div><strong>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</strong></div>
    <div class="center">
      <button onclick="openDetails()">‚úèÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      <button onclick="showHelp()">üìò Help</button>
      <button onclick="openSettings()">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</button>
    </div>
  </div>

  <!-- Details popup -->
  <div class="popup" id="detailsPopup">
    <div class="popup-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</div>
    <p class="small">‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡πá‡∏Å: &lt;name_team_a&gt;, &lt;name_team_b&gt;, &lt;label1&gt;‚Äì&lt;label3&gt;</p>
    <textarea id="detailsText"></textarea>
    <div class="row center">
      <button onclick="saveDetails()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      <button onclick="closeDetails()">‚ùå ‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <!-- Settings popup -->
  <div class="popup" id="settingsPopup">
    <div class="popup-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</div>
    <label>Image Folder Path</label>
    <input type="text" id="imagePath" value="C:/OBSAssets/logos">
    <label>Data Source</label>
    <select id="dataSource" onchange="toggleSource()">
      <option value="excel">Excel</option>
      <option value="google">Google Sheets</option>
    </select>
    <input type="text" id="sheetURL" placeholder="Google Sheet URL or ID" style="display:none;">
    <div class="row center">
      <button onclick="loadData()">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button onclick="closeSettings()">‚ùå ‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <script>
    let data = [], scoreA = 0, scoreB = 0, timer = 0, interval = null, half = "1st";

    function toggleSource() {
      document.getElementById("sheetURL").style.display =
        document.getElementById("dataSource").value === "google" ? "block" : "none";
    }

    function loadData() {
      const source = document.getElementById("dataSource").value;
      const path = document.getElementById("sheetURL").value.trim();
      if (!path) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠ URL");
      if (source === 'excel') {
        const input = document.createElement('input');
        input.type = 'file'; input.accept = '.xlsx';
        input.onchange = e => {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = evt => {
            const wb = XLSX.read(new Uint8Array(evt.target.result), { type: 'array' });
            const sheet = wb.Sheets[wb.SheetNames[0]];
            data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          };
          reader.readAsArrayBuffer(file);
        };
        input.click();
      } else {
        const gid = path.includes("docs.google") ? path.split("/d/")[1].split("/")[0] : path;
        fetch(`https://docs.google.com/spreadsheets/d/${gid}/gviz/tq?tqx=out:csv`)
          .then(r => r.text()).then(t => {
            const rows = t.split("\n").map(line => line.split(","));
            data = rows;
          }).catch(err => alert("‡πÇ‡∏´‡∏•‡∏î Google Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"));
      }
    }

    function applyRow() {
      const i = parseInt(document.getElementById('rowIndex').value);
      const row = data[i], header = data[0];
      if (!row) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ");
      const get = key => row[header.indexOf(key)] || "";
      document.getElementById("nameA").textContent = get("TeamA");
      document.getElementById("nameB").textContent = get("TeamB");
      document.getElementById("label1").textContent = get("label1");
      document.getElementById("label2").textContent = get("label2");
      document.getElementById("label3").textContent = get("label3");
      const path = document.getElementById("imagePath").value;
      document.getElementById("logoA").src = `${path}/${get("LogoA")}`;
      document.getElementById("logoB").src = `${path}/${get("LogoB")}`;
    }

    function changeScore(team, delta) {
      if (team === 'A') {
        scoreA = Math.max(0, scoreA + delta);
        document.getElementById('scoreA').textContent = scoreA;
      } else {
        scoreB = Math.max(0, scoreB + delta);
        document.getElementById('scoreB').textContent = scoreB;
      }
    }

    function resetScore() {
      scoreA = 0; scoreB = 0;
      document.getElementById('scoreA').textContent = "0";
      document.getElementById('scoreB').textContent = "0";
    }

    function startTimer() {
      if (interval) return;
      interval = setInterval(() => { timer++; updateTimerDisplay(); }, 1000);
    }

    function stopTimer() {
      clearInterval(interval); interval = null;
    }

    function resetTimer() {
      stopTimer(); timer = 0; updateTimerDisplay();
    }

    function setTime() {
      const input = prompt("Set time (MM:SS)", "00:00");
      if (!input) return;
      const [m, s] = input.split(":");
      timer = parseInt(m) * 60 + parseInt(s);
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const m = String(Math.floor(timer / 60)).padStart(2, '0');
      const s = String(timer % 60).padStart(2, '0');
      document.getElementById('timerText').textContent = `${m}:${s}`;
    }

    function toggleHalf() {
      half = (half === '1st') ? '2nd' : '1st';
      document.getElementById('halfText').textContent = half;
    }

    function openDetails() {
      document.getElementById("detailsText").value = localStorage.getItem("detailsText") || "";
      document.getElementById("detailsPopup").style.display = "block";
    }

    function closeDetails() {
      document.getElementById("detailsPopup").style.display = "none";
    }

    function saveDetails() {
      localStorage.setItem("detailsText", document.getElementById("detailsText").value);
      closeDetails();
    }

    function copyDetails() {
      const base = localStorage.getItem("detailsText") || "";
      const i = parseInt(document.getElementById('rowIndex').value);
      const header = data[0], rowData = data[i];
      if (!rowData) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß");
      const dict = {}; header.forEach((k, idx) => dict[k] = rowData[idx] || "");
      const output = base.replace(/<([^>]+)>/g, (_, key) => dict[key] || "");
      navigator.clipboard.writeText(output).then(() => alert("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß"));
    }

    function showHelp() {
      const sources = [
        "logo_team_a", "logo_team_b", "name_team_a", "name_team_b",
        "label_1", "label_2", "label_3", "score_team_a", "score_team_b",
        "half_text", "time_counter"
      ];
      let msg = "üìò OBS Sources ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ:

" + sources.map(s => `- ${s}`).join("\n");
      alert(msg);
    }

    function openSettings() {
      document.getElementById("settingsPopup").style.display = "block";
    }

    function closeSettings() {
      document.getElementById("settingsPopup").style.display = "none";
    }
  </script>
</body>
</html>
