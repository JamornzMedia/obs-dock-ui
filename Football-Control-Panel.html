<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Football Scoreboard Controller</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background: #121212; color: white; font-family: 'Segoe UI', sans-serif;
    }
    .container { max-width: 500px; margin: auto; padding: 10px; }
    .row, .logo-row, .label-row, .score-row, .footer-row { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
    .center { justify-content: center; }
    input, select, button { padding: 6px; border-radius: 4px; font-size: 0.9rem; border: none; }
    button { background: #219653; color: white; cursor: pointer; }
    button:hover { background: #1b7f45; }
    .logo-name { flex: 1; display: flex; flex-direction: column; align-items: center; }
    .logo-name img { width: 60px; height: 60px; object-fit: contain; background: #2a2a2a; border-radius: 6px; }
    .logo-name .name { font-size: 0.75rem; text-align: center; height: 2.4em; overflow: hidden; }
    .label-row div {
      flex: 1; background: #1e1e1e; text-align: center; font-size: 0.75rem; border-radius: 4px; padding: 4px;
    }
    .score-box, .button-col {
      display: flex; flex-direction: column; align-items: center; flex: 1;
    }
    .score-box .score { font-size: 2.2em; margin-bottom: 6px; }
    .button-col button.plus { width: 90%; font-size: 1.2rem; height: 40px; }
    .button-col button.minus {
      width: 90%; font-size: 0.9rem; height: 25px; background: #c0392b;
    }
    .section-divider { border-top: 1px solid #555; margin: 12px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <button onclick="handleExcel()">üìÇ Upload Excel</button>
      <label>Match ID:</label>
      <input type="number" id="matchID" min="1" value="1" style="width:60px;">
      <button onclick="applyMatch()">Load</button>
    </div>

    <div class="section-divider"></div>
    <div class="logo-row">
      <div class="logo-name">
        <img id="logoA" src="" alt="Logo A">
        <div class="name" id="nameA">Team A</div>
      </div>
      <div class="logo-name">
        <img id="logoB" src="" alt="Logo B">
        <div class="name" id="nameB">Team B</div>
      </div>
    </div>
    <div class="label-row">
      <div id="label1">Label 1</div>
      <div id="label2">Label 2</div>
      <div id="label3">Label 3</div>
    </div>

    <div class="section-divider"></div>
    <div><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong></div>
    <div class="score-row">
      <div class="score-box"><div class="score" id="scoreA">0</div></div>
      <div class="button-col">
        <button class="plus" onclick="changeScore('A', 1)">+1</button>
        <button class="minus" onclick="changeScore('A', -1)">-1</button>
      </div>
      <div class="score-box"><div class="score" id="scoreB">0</div></div>
      <div class="button-col">
        <button class="plus" onclick="changeScore('B', 1)">+1</button>
        <button class="minus" onclick="changeScore('B', -1)">-1</button>
      </div>
    </div>
    <div class="center">
      <button onclick="resetScore()">Reset Scores</button>
    </div>

    <div class="section-divider"></div>
    <div><strong>‡πÄ‡∏ß‡∏•‡∏≤</strong></div>
    <div class="footer-row">
      <button onclick="toggleHalf()">‡∏Ñ‡∏£‡∏∂‡πà‡∏á <span id="halfText">1st</span></button>
      <div style="flex:1;text-align:center">
        <div id="timerText" style="font-size:2em;">00:00</div>
        <div style="margin-top:5px;">
          <button onclick="startTimer()">Start</button>
          <button onclick="stopTimer()">Stop</button>
          <button onclick="resetTimer()">Reset</button>
          <button onclick="setTime()">Set</button>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>
    <div class="center">
      <button onclick="openDetails()">‚úèÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
      <button onclick="copyDetails()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
      <button onclick="showHelp()">üìò Help</button>
    </div>
  </div>

  <div id="detailsPopup" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#1e1e1e; padding:20px; border-radius:10px; width:90%; max-width:400px;">
    <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
    <p>‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡πá‡∏Å: &lt;TeamA&gt;, &lt;TeamB&gt;, &lt;label1&gt;, &lt;label2&gt;, &lt;label3&gt;, &lt;score_team_a&gt;, &lt;score_team_b&gt;</p>
    <textarea id="detailsText" style="width:100%; height:80px;"></textarea>
    <div class="row center">
      <button onclick="saveDetails()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      <button onclick="closeDetails()">‚ùå ‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <script>
    let sheetData = [], scoreA = 0, scoreB = 0, timer = 0, interval = null, half = '1st';

    function handleExcel() {
      const input = document.createElement('input');
      input.type = 'file'; input.accept = '.xlsx';
      input.onchange = e => {
        const reader = new FileReader();
        reader.onload = function(evt) {
          const workbook = XLSX.read(new Uint8Array(evt.target.result), { type: 'array' });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          sheetData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          alert("üìÅ ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î Load");
        };
        reader.readAsArrayBuffer(e.target.files[0]);
      };
      input.click();
    }

    function applyMatch() {
      const id = parseInt(document.getElementById('matchID').value);
      const header = sheetData[0];
      const rows = sheetData.slice(1);
      const match = rows.find(row => parseInt(row[0]) === id);
      if (!match) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö Match ID');
      const get = key => match[header.indexOf(key)] || '';
      const path = "C:/OBSAssets/logos";
      document.getElementById('nameA').textContent = get('TeamA');
      document.getElementById('nameB').textContent = get('TeamB');
      document.getElementById('label1').textContent = get('label1');
      document.getElementById('label2').textContent = get('label2');
      document.getElementById('label3').textContent = get('label3');
      document.getElementById('logoA').src = `${path}/${get('LogoA')}`;
      document.getElementById('logoB').src = `${path}/${get('LogoB')}`;
    }

    function changeScore(team, delta) {
      if (team === 'A') {
        scoreA = Math.max(0, scoreA + delta);
        document.getElementById('scoreA').textContent = scoreA;
      } else {
        scoreB = Math.max(0, scoreB + delta);
        document.getElementById('scoreB').textContent = scoreB;
      }
    }

    function resetScore() {
      scoreA = 0; scoreB = 0;
      document.getElementById('scoreA').textContent = "0";
      document.getElementById('scoreB').textContent = "0";
    }

    function startTimer() {
      if (interval) return;
      interval = setInterval(() => { timer++; updateTimerDisplay(); }, 1000);
    }

    function stopTimer() {
      clearInterval(interval); interval = null;
    }

    function resetTimer() {
      stopTimer(); timer = 0; updateTimerDisplay();
    }

    function setTime() {
      const input = prompt("Set time (MM:SS)", "00:00");
      if (!input) return;
      const [m, s] = input.split(":");
      timer = parseInt(m) * 60 + parseInt(s);
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const m = String(Math.floor(timer / 60)).padStart(2, '0');
      const s = String(timer % 60).padStart(2, '0');
      document.getElementById('timerText').textContent = `${m}:${s}`;
    }

    function toggleHalf() {
      half = (half === '1st') ? '2nd' : '1st';
      document.getElementById('halfText').textContent = half;
    }

    function openDetails() {
      document.getElementById("detailsText").value = localStorage.getItem("detailsText") || "";
      document.getElementById("detailsPopup").style.display = "block";
    }

    function closeDetails() {
      document.getElementById("detailsPopup").style.display = "none";
    }

    function saveDetails() {
      localStorage.setItem("detailsText", document.getElementById("detailsText").value);
      closeDetails();
    }

    function copyDetails() {
      const base = localStorage.getItem("detailsText") || "";
      const id = parseInt(document.getElementById('matchID').value);
      const header = sheetData[0];
      const rows = sheetData.slice(1);
      const match = rows.find(row => parseInt(row[0]) === id);
      if (!match) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß");
      const dict = {}; header.forEach((k, i) => dict[k] = match[i] || "");

      const alias = {
        name_team_a: 'TeamA',
        name_team_b: 'TeamB',
        team_a: 'TeamA',
        team_b: 'TeamB',
        score_team_a: 'scoreA',
        score_team_b: 'scoreB',
        time_counter: 'timerText',
        half_text: 'halfText'
      };

      const output = base.replace(/<([^>]+)>/g, (_, key) => {
        const realKey = alias[key] || key;
        return dict[realKey] || document.getElementById(realKey)?.textContent || "";
      });
      navigator.clipboard.writeText(output).then(() => alert("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß"));
    }

    function showHelp() {
      alert("üßæ ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡πá‡∏Å‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô <TeamA>, <label1>, <score_team_a>, <time_counter>, <half_text>");
    }
  </script>
</body>
</html>
