<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แดชบอร์ด</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient('https://pxleazlrryctlovxuwil.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...');
    const user = JSON.parse(localStorage.getItem('sb_user'));

    if (!user) location.href = 'index.html';

    document.addEventListener('DOMContentLoaded', async () => {
      document.getElementById('email').textContent = user.email;
      const { data, error } = await supabase
        .from('license_keys')
        .select('*')
        .eq('user_id', user.id)
        .eq('is_active', true)
        .order('expires_at', { ascending: false })
        .limit(1);

      if (error || !data.length) {
        document.getElementById('info').textContent = "ไม่พบ License Key ที่ใช้งานได้";
        return;
      }

      const expires = new Date(data[0].expires_at);
      const now = new Date();
      const diff = expires - now;
      const days = Math.floor(diff / 86400000);
      const hours = Math.floor((diff % 86400000) / 3600000);

      document.getElementById('info').innerHTML = `
        ใช้ได้ถึง: ${expires.toLocaleString()}<br/>
        เหลือเวลา: ${days} วัน ${hours} ชั่วโมง
      `;
    });

    window.logout = () => {
      localStorage.removeItem('sb_user');
      location.href = 'index.html';
    };
    window.enterApp = () => location.href = 'Football Control Panel.html';
  </script>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 2em; text-align: center; }
    button { padding: 10px 20px; margin: 10px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; }
    .btn-app { background: #4caf50; color: #fff; }
    .btn-logout { background: #f44336; color: #fff; }
  </style>
</head>
<body>
  <h2>ยินดีต้อนรับ</h2>
  <p id="email"></p>
  <p id="info"></p>
  <button class="btn-app" onclick="enterApp()">เข้าโปรแกรม</button>
  <button class="btn-logout" onclick="logout()">ออกจากระบบ</button>
</body>
</html>
