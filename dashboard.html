<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</title>
  <script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
const supabase = createClient('https://pxleazlrryctlovxuwil.supabase.co', 'eyJhbGciOi...');

async function init() {
  const user = JSON.parse(localStorage.getItem("sb_user"));
  const emailEl = document.getElementById("user-email");
  const licenseEl = document.getElementById("license-status");

  if (!user || !user.id) {
    window.location.href = "index.html";
    return;
  }

  emailEl.textContent = user.email;

  const { data, error } = await supabase
    .from("license_keys")
    .select("*")
    .eq("user_id", user.id)
    .eq("is_active", true)
    .limit(1)
    .maybeSingle();

  if (error || !data) {
    licenseEl.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö License Key ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ";
    return;
  }

  const expiresAt = new Date(data.expires_at);
  const now = new Date();
  const timeDiff = expiresAt - now;
  const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((timeDiff / (1000 * 60 * 60)) % 24);

  if (data.key.startsWith("BETA-")) {
    licenseEl.innerHTML = `
      üß™ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á (Beta)<br>
      ‚è≥ ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á: ${expiresAt.toLocaleString()}<br>
      üìÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å: ${days} ‡∏ß‡∏±‡∏ô ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    `;
  } else {
    licenseEl.innerHTML = `
      ‚úÖ License Key: ${data.key}<br>
      ‚è≥ ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: ${expiresAt.toLocaleString()}<br>
      üìÖ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å: ${days} ‡∏ß‡∏±‡∏ô ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    `;
  }
}

document.getElementById("logout").onclick = () => {
  localStorage.removeItem("sb_user");
  window.location.href = "index.html";
};

init();
</script>

  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 2em; text-align: center; }
    button { padding: 10px 20px; margin: 10px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; }
    .btn-app { background: #4caf50; color: #fff; }
    .btn-logout { background: #f44336; color: #fff; }
  </style>
</head>
<body>
  <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
  <p id="email"></p>
  <p id="info"></p>
  <p id="user-email"></p>
<div id="license-status" style="margin-top:1em;color:#ffcc00;"></div>
  <button class="btn-app" onclick="enterApp()">‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</button>
  <button class="btn-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</body>
</html>
