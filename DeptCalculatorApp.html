<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมคำนวณและอธิบายหนี้ V2</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font: Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Icons = {
            Calc: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            ArrowRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            Back: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        };

        // --- View 1: Calculator ---
        const CalculatorView = ({ data, setData, onCalculate, result, onGoToExplanation }) => {
            const fmt = (num) => num ? num.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00';

            return (
                <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 animate-pop">
                    {/* Header */}
                    <div className="bg-blue-800 text-white p-6">
                        <h1 className="text-2xl font-bold flex items-center gap-2">
                            <Icons.Calc /> โปรแกรมคำนวณดอกเบี้ยและหนี้
                        </h1>
                        <p className="text-blue-200 text-sm mt-1">เครื่องมือตรวจสอบความถูกต้องของยอดหนี้</p>
                    </div>

                    <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                        {/* Input Section */}
                        <div className="space-y-4">
                            <h2 className="text-lg font-semibold text-gray-700 border-b pb-2">1. กรอกข้อมูลสัญญา</h2>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm text-gray-600 mb-1">วันที่เริ่ม</label>
                                    <input type="date" value={data.startDate} onChange={e => setData({...data, startDate: e.target.value})} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm text-gray-600 mb-1">วันที่สิ้นสุด</label>
                                    <input type="date" value={data.endDate} onChange={e => setData({...data, endDate: e.target.value})} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none" />
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm text-gray-600 mb-1">เงินต้นคงเหลือ (บาท)</label>
                                <input type="number" value={data.principal} onChange={e => setData({...data, principal: e.target.value})} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono" />
                            </div>
                            <div>
                                <label className="block text-sm text-gray-600 mb-1">ดอกเบี้ยค้างชำระ (บาท)</label>
                                <input type="number" value={data.accruedInterest} onChange={e => setData({...data, accruedInterest: e.target.value})} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono" />
                            </div>
                            <div>
                                <label className="block text-sm text-gray-600 mb-1">ดอกเบี้ย (%)</label>
                                <input type="number" value={data.interestRate} onChange={e => setData({...data, interestRate: e.target.value})} className="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono" />
                            </div>

                            <button 
                                onClick={onCalculate}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow transition transform active:scale-95 flex justify-center items-center gap-2 mt-4"
                            >
                                <Icons.Calc /> คำนวณยอดหนี้
                            </button>
                        </div>

                        {/* Result Section */}
                        <div className="bg-gray-50 rounded-lg p-6 border border-gray-200 flex flex-col justify-between">
                            <div>
                                <h2 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">2. ผลลัพธ์การเปรียบเทียบ</h2>
                                {result ? (
                                    <div className="space-y-6">
                                        <div className="flex justify-between items-center bg-white p-3 rounded border">
                                            <span className="text-gray-500">ระยะเวลา</span>
                                            <span className="font-bold text-blue-600">{result.days} วัน</span>
                                        </div>

                                        {/* Green Box (Correct) */}
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4 relative">
                                            <div className="absolute top-0 right-0 bg-green-500 text-white text-xs px-2 py-1 rounded-bl">ถูกต้อง</div>
                                            <div className="text-sm text-green-800 font-semibold mb-1">ยอดที่ควรจะเป็น (Fair)</div>
                                            <div className="flex justify-between items-end">
                                                <div className="text-xs text-green-600">ต้น {fmt(result.currentTotalDebt)} + ดอก {fmt(result.futureInterest)}</div>
                                                <div className="text-2xl font-bold text-green-700">{fmt(result.fairTotal)}</div>
                                            </div>
                                        </div>

                                        {/* Red Box (Incorrect) */}
                                        <div className="bg-red-50 border border-red-200 rounded-lg p-4 relative">
                                            <div className="absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-bl">คิดซ้อน (Unfair)</div>
                                            <div className="text-sm text-red-800 font-semibold mb-1">ยอดที่คิดผิด (Compound)</div>
                                            <div className="flex justify-between items-end">
                                                <div className="text-xs text-red-600">ต้น {fmt(result.inflatedPrincipal)} + ดอก {fmt(result.unfairInterest)}</div>
                                                <div className="text-2xl font-bold text-red-700">{fmt(result.inflatedPrincipal + result.unfairInterest)}</div>
                                            </div>
                                            
                                            {/* Diff Badge */}
                                            {result.difference > 0 && (
                                                <div className="mt-3 bg-white border border-red-200 p-2 rounded text-center text-red-600 text-sm font-bold shadow-sm">
                                                    มีส่วนต่างเกินมา: +{fmt(result.difference)} บาท
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="h-full flex items-center justify-center text-gray-400 text-sm italic">
                                        กรุณากดปุ่ม "คำนวณยอดหนี้"
                                    </div>
                                )}
                            </div>

                            {/* Button to Explanation */}
                            {result && (
                                <button 
                                    onClick={onGoToExplanation}
                                    className="mt-6 w-full bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 border border-gray-300 rounded shadow-sm flex items-center justify-center gap-2 transition"
                                >
                                    <Icons.BookOpen />
                                    ดูแผนภาพอธิบาย (สำหรับเจ้าหน้าที่)
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- View 2: Explanation (Visual Blocks) ---
        const ExplanationView = ({ result, onBack }) => {
            const fmt = (num) => num ? num.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00';
            
            return (
                <div className="max-w-5xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 animate-pop min-h-screen md:min-h-0">
                    <div className="bg-gray-800 text-white p-4 flex items-center justify-between sticky top-0 z-10">
                        <button onClick={onBack} className="flex items-center gap-1 hover:text-blue-200 transition">
                            <Icons.Back /> ย้อนกลับ
                        </button>
                        <h1 className="text-lg font-bold">แผนภาพอธิบายโครงสร้างหนี้</h1>
                        <div className="w-16"></div> {/* Spacer */}
                    </div>

                    <div className="p-8 overflow-y-auto">
                        <div className="text-center mb-8">
                            <h2 className="text-2xl font-bold text-gray-800">ทำไมยอดถึงไม่เท่ากัน?</h2>
                            <p className="text-gray-500">เปรียบเทียบโครงสร้างเงินต้นและดอกเบี้ยแบบเข้าใจง่าย</p>
                        </div>

                        {/* --- Diagram 1: Correct --- */}
                        <div className="mb-12">
                            <h3 className="text-xl font-bold text-green-700 mb-4 flex items-center gap-2">
                                <span className="bg-green-100 p-1 rounded">✅ แบบที่ 1: ถูกต้อง (เป็นธรรม)</span>
                            </h3>
                            <div className="bg-green-50 p-6 rounded-xl border border-green-100 flex flex-col md:flex-row items-center justify-center gap-6">
                                
                                {/* Start State */}
                                <div className="text-center relative group">
                                    <div className="mb-2 text-sm font-semibold text-gray-600">เงินต้นเริ่มสัญญา</div>
                                    <div className="flex flex-col items-center gap-1">
                                        {/* Box: Principal */}
                                        <div className="w-32 h-24 bg-blue-500 rounded-lg shadow-md flex items-center justify-center text-white font-bold text-lg relative z-10">
                                            เงินต้น
                                            <span className="absolute bottom-1 text-xs opacity-75">{fmt(result.principal)}</span>
                                        </div>
                                        {/* Box: Accrued Interest */}
                                        <div className="w-32 h-8 bg-orange-400 rounded-lg shadow-md flex items-center justify-center text-white text-xs font-bold">
                                            ดอกเบี้ยค้าง
                                        </div>
                                    </div>
                                    <div className="mt-2 text-sm font-bold text-gray-700">รวม: {fmt(result.currentTotalDebt)}</div>
                                </div>

                                {/* Arrow */}
                                <div className="flex flex-col items-center text-gray-400">
                                    <span className="text-xs mb-1">ผ่านไป {result.days} วัน</span>
                                    <Icons.ArrowRight />
                                    <span className="text-xs mt-1">ดอกเบี้ยเดินปกติ</span>
                                </div>

                                {/* End State */}
                                <div className="text-center">
                                    <div className="mb-2 text-sm font-semibold text-gray-600">ปลายงวด</div>
                                    <div className="flex flex-col items-center gap-1">
                                        <div className="w-32 h-24 bg-blue-500 rounded-lg shadow-md opacity-80 flex items-center justify-center text-white text-sm">เงินต้นเดิม</div>
                                        <div className="w-32 h-8 bg-orange-400 rounded-lg shadow-md opacity-80 flex items-center justify-center text-white text-xs">ดอกค้างเดิม</div>
                                        {/* New Interest */}
                                        <div className="w-32 h-10 bg-green-500 rounded-lg shadow-lg flex items-center justify-center text-white font-bold relative animate-pulse">
                                            ดอกเบี้ยใหม่
                                            <span className="absolute -right-24 text-green-700 font-bold text-sm w-20 text-left">+{fmt(result.futureInterest)}</span>
                                        </div>
                                    </div>
                                    <div className="mt-2 text-sm font-bold text-green-700">ยอดรวม: {fmt(result.fairTotal)}</div>
                                </div>
                            </div>
                        </div>

                        {/* --- Diagram 2: Incorrect --- */}
                        <div>
                            <h3 className="text-xl font-bold text-red-700 mb-4 flex items-center gap-2">
                                <span className="bg-red-100 p-1 rounded">❌ แบบที่ 2: ผิด (คิดดอกเบี้ยซ้อน)</span>
                            </h3>
                            <div className="bg-red-50 p-6 rounded-xl border border-red-100 flex flex-col md:flex-row items-center justify-center gap-6">
                                
                                {/* Start State */}
                                <div className="text-center">
                                    <div className="mb-2 text-sm font-semibold text-gray-600">เงินต้นเริ่มสัญญา (บวม)</div>
                                    <div className="p-2 border-2 border-dashed border-red-300 rounded-xl relative">
                                        <div className="absolute -top-3 left-4 bg-red-100 text-red-600 text-xs px-2 font-bold">ถูกมัดรวมเป็นก้อนเดียว</div>
                                        <div className="flex flex-col items-center gap-1">
                                            <div className="w-32 h-24 bg-blue-500 rounded-lg shadow-md flex items-center justify-center text-white text-sm">เงินต้น</div>
                                            <div className="w-32 h-8 bg-orange-400 rounded-lg shadow-md flex items-center justify-center text-white text-xs">ดอกเบี้ยค้าง</div>
                                            {/* Ghost Block */}
                                            <div className="w-32 h-10 bg-gray-400 rounded-lg shadow-md flex items-center justify-center text-white text-xs opacity-75 relative">
                                                ดอกเบี้ยอนาคต
                                                <span className="absolute -left-24 text-xs text-gray-500 w-20 text-right">เอามาบวกทำไม?</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-2 text-sm font-bold text-red-700">ตั้งต้น: {fmt(result.inflatedPrincipal)}</div>
                                </div>

                                {/* Arrow */}
                                <div className="flex flex-col items-center text-gray-400">
                                    <span className="text-xs mb-1">ผ่านไป {result.days} วัน</span>
                                    <Icons.ArrowRight />
                                    <span className="text-xs mt-1 text-red-500 font-bold">คิดดอกบนก้อนบวม</span>
                                </div>

                                {/* End State */}
                                <div className="text-center">
                                    <div className="mb-2 text-sm font-semibold text-gray-600">ปลายงวด</div>
                                    <div className="flex flex-col items-center gap-1">
                                        <div className="w-32 h-24 bg-blue-500 opacity-50 rounded-lg"></div>
                                        <div className="w-32 h-8 bg-orange-400 opacity-50 rounded-lg"></div>
                                        <div className="w-32 h-10 bg-gray-400 opacity-50 rounded-lg"></div>
                                        
                                        {/* Resulting Interest */}
                                        <div className="flex gap-1 w-32 justify-center">
                                            {/* Normal Interest */}
                                            <div className="w-24 h-10 bg-green-500 rounded-l-lg flex items-center justify-center text-white text-xs">
                                                ดอกปกติ
                                            </div>
                                            {/* Extra Interest (The Problem) */}
                                            <div className="w-8 h-10 bg-red-600 rounded-r-lg flex items-center justify-center text-white font-bold text-xs relative animate-bounce">
                                                !!!
                                                <div className="absolute left-10 top-2 bg-red-600 text-white text-xs p-1 rounded shadow whitespace-nowrap">
                                                    ส่วนต่าง {fmt(result.difference)}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-2 text-sm font-bold text-red-700">ยอดรวม: {fmt(result.inflatedPrincipal + result.unfairInterest)}</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 text-center text-sm text-blue-800">
                            <strong>สรุป:</strong> ก้อนสีแดง "!!!" คือดอกเบี้ยที่เกิดจากก้อนสีเทา (ดอกเบี้ยอนาคต) ที่เราเผลอเอาไปรวมเป็นเงินต้นแต่แรกครับ
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main Controller ---
        const App = () => {
            const [view, setView] = useState('calculator'); // 'calculator' | 'explanation'
            const [data, setData] = useState({
                startDate: '2026-01-22',
                endDate: '2026-03-31',
                principal: 186794,
                accruedInterest: 921.18,
                interestRate: 5
            });
            const [result, setResult] = useState(null);

            const calculate = () => {
                const start = new Date(data.startDate);
                const end = new Date(data.endDate);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                if (isNaN(diffDays)) return;

                const currentTotalDebt = parseFloat(data.principal) + parseFloat(data.accruedInterest);
                const futureInterestRaw = currentTotalDebt * (data.interestRate / 100) * (diffDays / 365);
                const futureInterest = parseFloat(futureInterestRaw.toFixed(2));
                const fairTotal = currentTotalDebt + futureInterest;

                const inflatedPrincipal = Math.ceil(fairTotal); // Simulate the error scenario
                const unfairInterest = inflatedPrincipal * (data.interestRate / 100) * (diffDays / 365);
                const difference = unfairInterest - futureInterest;

                setResult({
                    days: diffDays,
                    principal: parseFloat(data.principal),
                    accruedInterest: parseFloat(data.accruedInterest),
                    currentTotalDebt,
                    futureInterest,
                    fairTotal,
                    inflatedPrincipal,
                    unfairInterest,
                    difference
                });
            };

            return (
                <div className="min-h-screen py-8 px-4 flex items-center justify-center">
                    {view === 'calculator' ? (
                        <CalculatorView 
                            data={data} 
                            setData={setData} 
                            onCalculate={calculate} 
                            result={result}
                            onGoToExplanation={() => setView('explanation')} 
                        />
                    ) : (
                        <ExplanationView 
                            result={result} 
                            onBack={() => setView('calculator')} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


