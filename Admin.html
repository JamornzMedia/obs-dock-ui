<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ License ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://pxleazlrryctlovxuwil.supabase.co',
      'YOUR_PUBLIC_ANON_KEY'
    );

    window.updateLicense = async () => {
      const email = document.getElementById('email').value.trim();
      const plan = document.getElementById('plan').value;
      const status = document.getElementById('status');
      status.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";

      const planDays = {
        beta: 15,
        rent15: 15,
        rent30: 30,
        rent365: 365,
        full: 365 * 99  // ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å‡πÅ‡∏ó‡∏ô‡∏ñ‡∏≤‡∏ß‡∏£
      };

      const { data: userData, error: userError } = await supabase.auth.admin.getUserByEmail(email);
      if (userError || !userData?.user) {
        status.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ";
        return;
      }

      const user_id = userData.user.id;
      const expires = new Date();
      expires.setDate(expires.getDate() + planDays[plan]);

      const plan_key = plan === 'beta' ? 'BETA-' : 'PAID-';
      const key = plan_key + Math.random().toString(36).substring(2, 10).toUpperCase();

      const { error: upsertError } = await supabase
        .from("license_keys")
        .upsert([{
          key,
          user_id,
          is_active: true,
          expires_at: expires.toISOString(),
          plan_type: plan
        }], { onConflict: ['user_id'] });

      if (upsertError) {
        status.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + upsertError.message;
      } else {
        status.textContent = `‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äì ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${expires.toLocaleString()}`;
      }
    };
  </script>
  <style>
    body { font-family: sans-serif; background: #1e1e1e; color: #fff; padding: 2em; }
    .form-group { margin-bottom: 1em; }
    label { display: block; margin-bottom: 0.2em; }
    input, select, button {
      width: 100%; padding: 0.6em; font-size: 1em;
      border-radius: 8px; border: none;
    }
    input, select { background: #333; color: #fff; }
    button { background: #ffcc00; color: #000; cursor: pointer; }
    #status { margin-top: 1em; color: #00ccff; }
  </style>
</head>
<body>
  <h2>üë©‚Äçüíº ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ License ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
  <div class="form-group">
    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
    <input type="email" id="email" placeholder="user@example.com" />
  </div>
  <div class="form-group">
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó License</label>
    <select id="plan">
      <option value="beta">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏ü‡∏£‡∏µ 15 ‡∏ß‡∏±‡∏ô</option>
      <option value="rent15">‡πÄ‡∏ä‡πà‡∏≤ 15 ‡∏ß‡∏±‡∏ô ‚Äì 150 ‡∏ö‡∏≤‡∏ó</option>
      <option value="rent30">‡πÄ‡∏ä‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô ‚Äì 250 ‡∏ö‡∏≤‡∏ó</option>
      <option value="rent365">‡πÄ‡∏ä‡πà‡∏≤ 365 ‡∏ß‡∏±‡∏ô ‚Äì 2500 ‡∏ö‡∏≤‡∏ó</option>
      <option value="full">‡∏ñ‡∏≤‡∏ß‡∏£ ‚Äì 4500 ‡∏ö‡∏≤‡∏ó</option>
    </select>
  </div>
  <button onclick="updateLicense()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å License</button>
  <div id="status"></div>
</body>
</html>
